## 一、现有系统技术基础

- 手部检测与追踪：基于MediaPipe Hands实现单手21个关键点实时检测

- 多模态手势识别：已实现四种书写触发手势（食指伸直、拇指食指捏合、按压中关节、三指捏合）

- 自适应轨迹平滑：基于速度和曲率的智能平滑策略，动态调整平滑窗口（3-10帧），在高曲率区域保留细节

- 在线轨迹处理：完整的数据处理流水线，包含时序数据结构（`TracePoint`）、自动分词机制和轨迹段管理

- 可视化与分析：多视角轨迹分析工具，支持投影密度热力图、PCA主成分分析、连笔检测和速度统计

## 二、系统优化方案：手掌书写模式

### 2.1 研究动机

现有空中书写系统存在以下限制：

1. 长时间疲劳：手臂悬空书写导致肌肉持续紧张
2. 动作明显：不适合会议等需要低调输入的场景
3. 稳定性问题：缺乏物理支撑导致轨迹抖动

解决思路：引入"手掌书写"模式——一只手掌作为虚拟画布，另一只手在其上书写，结合物理触觉反馈提升书写体验。

### 2.2 理论支撑与动力学建模

#### (1) 交互效率分析 (Fitts's Law)

引入人机交互领域的经典理论——菲茨定律 (Fitts's Law)：$MT = a + b \cdot \log_2(1 + \frac{D}{W})$
其中 $MT$ 为完成动作时间，$D$ 为目标距离，$W$ 为目标宽度。

- 相比空中书写，手掌书写提供了物理触觉边界，有效增大了有效目标宽度 $W$（触觉反馈降低了对精细运动控制的需求），从而降低了操作难度指数（Index of Difficulty, $ID$）。
- 本研究旨在量化验证 $ID$ 的降低对书写速度和精度的提升效果。

#### (2) 手掌坐标系 (Coordinate System)

构建从相机空间到字符空间的映射，利用随动坐标系处理手掌运动。

1. 坐标空间：
   
   - 相机空间 ($C$): MediaPipe 世界坐标系。
   - 手掌空间 ($P$): 以掌心为原点的局部坐标系。
   - 屏幕空间 ($S$): 二维显示平面。

2. 变换矩阵：
   从相机到手掌空间的变换矩阵 $T_{C}^{P}$：
   
   $$
   T_{C}^{P} = \begin{bmatrix}
R_{3\times3} & t_{3\times1} \\
0_{1\times3} & 1
\end{bmatrix}^{-1}
   $$
   
   其中，$R$ 由手掌法向量 $\vec{n}$ 和其正切向量 $\vec{u}$ 构建，$t$ 为掌心坐标。

3. 动态补偿机制：
   对每一帧 $t$，计算瞬时变换矩阵 $M_t$，将笔尖坐标 $p_t$ 映射回参考帧 $t_0$ 的手掌空间，消除手掌自身微小位移与旋转对笔迹形状的影响：
   
   $$
   p_{corrected} = (T_{C}^{P})_{t_0} \cdot (T_{C}^{P})_t^{-1} \cdot p_t
   $$

### 2.3 双手协同检测

- 双手检测：配置MediaPipe Hands检测双手，获取关键点
- 角色识别：
  - 基于位置关系的规则
  - 结合惯用手设定
  - 基于运动模式的动态判别

### 2.4 平面拟合与投影

#### (1) 平面拟合 (Plane Fitting)

- 参考点：掌根、食指根、小指根。
- 拟合：使用 RANSAC 算法拟合平面方程 $Ax + By + Cz + D = 0$。

#### (2) 投影

- 计算食指尖在平面上的投影点 $P_{proj}$，作为输入，消除Z轴抖动。

### 2.5 接触检测 (Contact Detection)

#### (1) 状态机

```
HOVERING (悬停) → TOUCHING (接触) → WRITING (书写) → LIFTED (抬起)
     ↑_____________________________________________________|
```

#### (2) 多特征融合

使用分类器（如Random Forest / MLP），融合特征进行判定：

- 距离特征 ($d_z$): 指尖到平面的距离。
- 形态特征 ($\Delta S$): 重叠区域面积变化率。
- 运动特征 ($a_n$): 指尖法向加速度。
- 置信度特征 ($C_{conf}$): 关键点可见性得分。

### 2.6 空间交互 (Space Interaction)

#### (1) 动态视窗滑动策略 (Sliding Window Mapping)

针对手掌物理尺寸受限问题（约 $8cm \times 10cm$），模仿纸张滚动逻辑：

- 边缘检测：当书写点接近手掌边缘（Bounding Box 边界 10% 区域）时，触发虚拟画布反向滚动。
- 坐标重映射：$P_{virtual} = P_{local} + \vec{V}_{scroll} \cdot \Delta t$，实现无限书写空间。

#### (2) 语义感知校正 (Semantic-Aware Correction)

- 引入轻量级 NLP 模型，针对空间受限导致的笔画挤压变形进行语义校正。如果识别置信度低，则根据前后文（偏旁部首、词组搭配）自动还原用户意图。

### 2.7 遮挡处理 (Occlusion Handling)

#### (1) 轨迹预测 (Prediction)

针对遮挡导致的丢失，构建 Kalman-BiLSTM 模型。

- 预测：利用双向LSTM挖掘时空上下文，结合物理惯性预测位姿。
- 特征：前序帧的关键点坐标及速度。

#### (2) 状态滤波 (SRIF)

使用 平方根信息滤波 (SRIF) 替代扩展卡尔曼滤波 (EKF)。

- 稳定性：通过传播信息矩阵平方根，避免协方差矩阵发散。
- 平滑：融合预测值与后验估计，保证轨迹连续性。

## 三、实验验证方案

### 3.1 视觉模块评估 (Vision Layout Evaluation)

评估视觉模块在不同环境下的表现。

#### 3.1.1 实验设置

1. 环境 (Environment):
   
   - 光照: 低照度 ($< 50\ lx$)、标准 ($300-500\ lx$)、强光 ($> 1000\ lx$)。
   - 背景: 纯色、杂乱、动态背景。

2. 受试者 (Subjects):
   
   - 手掌特征: 20 名受试者，分为 Small, Medium, Large 三组。
   - 肤色: 覆盖 Fitzpatrick Skin Type I-V 型。

3. 系统压力测试 (System Stress Test):
   
   - 运动速度: 引入动捕系统 (如 OptiTrack 或 Leap Motion) 作为 Ground Truth。测试手部移动速度从 $0.1\ m/s$ 递增至 $1.0\ m/s$（步长 $0.1\ m/s$）时的跟踪性能，量化运动模糊 (Motion Blur) 对关键点丢失的影响。

#### 3.1.2 指标 (Metrics)

1. 平均位置误差 (MPJPE):
   $$ E_{pos} = \frac{1}{N \cdot M} \sum_{i=1}^{N} \sum_{j=1}^{M} \| P_{pred}^{(i,j)} - P_{gt}^{(i,j)} \|_2 $$
   其中 $N$ 为帧数，$M=21$ 为关节点数，$P_{gt}$ 为真值坐标。衡量几何重建精度。

2. 检测失败率 (Detection Failure Rate, DFR):
   定义为不可用帧的占比。若某帧关键点平均置信度 (Confidence Score) $< 0.5$ 或 MPJPE $> 30\ mm$，则视为检测失败。

3. 抖动幅度 (Jitter Magnitude):
   在手部保持静止悬停 (Hovering) 状态下，计算关键点坐标的标准差，评估平滑算法对微颤的抑制效果：
   $$ J = \sqrt{\frac{1}{T} \sum_{t=1}^{T} (p_t - \bar{p})^2} $$

#### 3.1.3 遮挡实验 (Occlusion Test)

验证遮挡下的轨迹重构质量。

条件：

1. Baseline: 无补偿。
2. Linear: 线性插值。
3. Hybrid: Kalman-BiLSTM + SRIF。

指标：

- DTW 距离: 重构轨迹与真值的距离。
- $L_2$ 漂移: 遮挡结束时的误差。

结果记录：

| 配置       | DTW 距离 | $L_2$ Drift (mm) | 平滑度    |
|:-------- |:------:|:----------------:|:------:|
| Baseline | N/A    | $> 50.4$         | High   |
| Linear   | $12.5$ | $18.2$           | Medium |
| Bi-LSTM  | $5.8$  | $8.6$            | Low    |
| Ours     | $3.2$  | $4.1$            | Lowest |

### 3.2 实验设计 (Experiment Design)

采用 $3 \times 3$ 重复测量设计。

#### 3.2.1 变量

- 自变量：
  
  1. 模态: Air Writing, Palm Writing, Tablet。
  2. 场景: Static Sitting, Standing, Desktop Supported。

- 控制变量：HMD/屏幕显示，CASIA-HWDB 内容。

#### 3.2.2 评价指标体系 (Metrics Framework)

数据采集涵盖三个维度，以评估系统效能：

1. 任务绩效 (Task Performance)：
   
   - 字符错误率 (Character Error Rate, CER)：基于 Levenshtein 距离计算的识别后文本错误比率。
   - 吞吐量 (Throughput, $TP$)：依据 Fitts's Law 变体，计算每秒有效信息传输量 (bits/s)，反映输入兼顾速度与精度的能力。
   - 轨迹偏移偏差 (Trajectory Deviation)：计算重投影轨迹与标准模板（Ground Truth）之间的动态时间规整（DTW）距离，量化形状保真度。

2. 生理特征与疲劳度 (Physical Traits & Fatigue)：
   
   - 性能退化率 (Degradation Rate)：引入持续 15 分钟的中长期疲劳诱导任务，测量第 1 分钟与第 15 分钟书写速度与精度的下降百分比。
   - 微颤抖动量 (Micro-tremor)：通过加速度数据的高频分量分析，评估肌肉疲劳引起的不自主抖动。

3. 主观感受 (Subjective Perception)：
   
   - 认知负荷：使用 NASA-TLX 量表评估精神需求、身体需求、努力程度等 6 个维度。
   - 用户体验：基于 UEQ (User Experience Questionnaire) 和自定义李克特量表 (Likert Scale)，评估感知的沉浸感、自然度与舒适度。

#### 3.2.3 遮挡评估

- 条件：重叠比例 0%, 25%, 50%, >75%。
- 指标：置信度损失，轨迹完整度 ($R^2$)。

#### 3.2.4 分析

采用 双因素方差分析 (ANOVA) 检验主效应及交互效应。

### 3.5 鲁棒性测试 (Robustness Test)

- 光照：低照度、强背光。
- 背景：动态背景。
- 遮挡：不同程度自遮挡。

## 四、技术风险与应对策略

### 4.1 手部遮挡与关键点丢失

书写手可能遮挡画布手关键点，导致手掌平面计算失败。

失效场景：

- 书写手从画布手上方经过
- 侧向角度导致部分手指不可见
- 快速移动造成运动模糊

### 4.2 书写区域受限问题

手掌面积（约8cm×10cm）远小于传统书写区域，限制复杂字符的书写。
